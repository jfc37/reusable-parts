<div class="fuse-card">

  <div class="mat-light-blue-600-bg">

    <div class="p-16"
      fxLayout="row"
      fxLayoutAlign="space-between center">
      <div class="pr-16">
        <div class="h1 font-weight-300">{{model.title}}</div>
      </div>

      <div>
        <button mat-icon-button
          [matMenuTriggerFor]="card19Menu"
          aria-label="more">
          <mat-icon>more_vert</mat-icon>
        </button>

        <mat-menu #card19Menu="matMenu">
          <button mat-menu-item
            color="accent"
            (click)="expand()">
            <mat-icon>fullscreen</mat-icon>
            <span>Expand</span>
          </button>
          <button mat-menu-item
            color="warn"
            [disabled]="model.deleting"
            (click)="delete()">
            <mat-icon>delete</mat-icon>
            <span>{{deleteButtonText}}</span>
          </button>
        </mat-menu>
      </div>
    </div>
  </div>
  <mat-accordion>

    <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{model.ingredientsTitle}}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <form name="ingredientsForm"
        (submit)="submitIngredientsForm()"
        novalidate>
        <div *ngFor="let row of ingredientsFormArray.controls; let i = index;">
          <mat-form-field>
            <input matInput
              #focus
              class="focus"
              placeholder="Quantity"
              autocomplete="off"
              [formControl]="row.get('quantity')">
            <mat-error *ngIf="displayError(row.get('quantity'))">
              Please enter a value
            </mat-error>
          </mat-form-field>
          <mat-form-field>
            <input matInput
              placeholder="Ingredient"
              autocomplete="off"
              [formControl]="row.get('food')">
            <mat-error *ngIf="displayError(row.get('food'))">
              Please enter a value
            </mat-error>
          </mat-form-field>
          <button mat-button
            color="warn"
            (click)="removeIngredient(i)">
            <mat-icon>remove_circle_outline</mat-icon>
          </button>
        </div>
        <button mat-button
          color="accent"
          (click)="addIngredient()">
          <mat-icon>add_circle_outline</mat-icon>
        </button>
        <button mat-button
          color="accent"
          [disabled]="isIngredientsSubmitDisabled()">{{updateButtonText}}</button>
      </form>
    </mat-expansion-panel>

    <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)">
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{model.preparationTitle}}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <form name="preparationsForm"
        (submit)="submitPreparationsForm()"
        novalidate>
        <div *ngFor="let row of preparationsFormArray.controls; let i = index;">
          <mat-form-field>
            <input matInput
              #focus
              class="focus"
              placeholder="Step"
              autocomplete="off"
              [formControl]="row">
            <mat-error *ngIf="displayError(row)">
              Please enter a value
            </mat-error>
          </mat-form-field>
          <button mat-button
            color="warn"
            (click)="removePreparation(i)">
            <mat-icon>remove_circle_outline</mat-icon>
          </button>
        </div>
        <button mat-button
          color="accent"
          (click)="addPreparation()">
          <mat-icon>add_circle_outline</mat-icon>
        </button>
        <button mat-button
          color="accent"
          [disabled]="isPreparationsSubmitDisabled()">{{updateButtonText}}</button>
      </form>
    </mat-expansion-panel>

    <mat-expansion-panel [expanded]="step === 3" (opened)="setStep(3)">
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{model.cookingStepsTitle}}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <form name="cookingStepsForm"
        (submit)="submitCookingStepsForm()"
        novalidate>
        <div *ngFor="let row of cookingStepsFormArray.controls; let i = index;">
          <mat-form-field>
            <input matInput
              #focus
              class="focus"
              placeholder="Step"
              autocomplete="off"
              [formControl]="row">
            <mat-error *ngIf="displayError(row)">
              Please enter a value
            </mat-error>
          </mat-form-field>
          <button mat-button
            color="warn"
            (click)="removeCookingSteps(i)">
            <mat-icon>remove_circle_outline</mat-icon>
          </button>
        </div>
        <button mat-button
          color="accent"
          (click)="addCookingSteps()">
          <mat-icon>add_circle_outline</mat-icon>
        </button>
        <button mat-button
          color="accent"
          [disabled]="isCookingStepsSubmitDisabled()">{{updateButtonText}}</button>
      </form>
    </mat-expansion-panel>

    <mat-expansion-panel [expanded]="step === 4" (opened)="setStep(4)">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <ng-container *ngIf="model.link; else noLink">
              <a target="_blank"
                [href]="model.link">Link</a>
            </ng-container>
            <ng-template #noLink>
              No link
            </ng-template>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <form name="linkForm"
          (submit)="submitLinkForm()"
          novalidate>
          <mat-form-field>
            <input matInput
              placeholder="Link"
              autocomplete="off"
              [formControl]="linkFormControl">
            <mat-error *ngIf="displayError(linkFormControl)">
              Please enter a link
            </mat-error>
          </mat-form-field>

          <button mat-button
            color="accent"
            [disabled]="isLinkSubmitDisabled()">{{updateButtonText}}</button>
        </form>
      </mat-expansion-panel>
  </mat-accordion>
</div>
